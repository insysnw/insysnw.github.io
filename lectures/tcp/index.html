<!DOCTYPE html>
<html lang="ru">
  <head>
    <link rel="stylesheet" href="/fonts/stylesheet.css" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Курс ТКС</title>
    <link
      rel="stylesheet"
      href="/insysnw.css"
    />
	<!--
	  Pins footer to the bottom
	  TODO: place it properly
	-->
    <style>
      .course {
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      body {
        display: flex;
        min-height: 100vh;
        flex-direction: column;
      }

      footer {
        margin-top: auto;
      }
    </style>
  </head>

  <body>
    <div class="course">
      <header>
        <nav class="level nerd">
          <p class="level-item has-text-centered">
		    <a href="/lectures">
              <span class="icon">
                <i class="mdi mdi-24px mdi-book-open-page-variant" aria-hidden="true"></i>
              </span>
              <span class="f3270">Лекции</span>
            </a>
          </p>
          <p class="level-item has-text-centered">
		    <a href="/practice">
              <span class="icon">
                <i class="mdi mdi-24px mdi-flask" aria-hidden="true"></i>
              </span>
              <span class="f3270">Практика</span>
            </a>
          </p>
          <p class="level-item has-text-centered">
            <img
              src="https://icst.spbstu.ru/userfiles/files/Risunok-KSPT.png"
              alt="КСПТ"
              style="height: 50px"
            />
          </p>
          <p class="level-item has-text-centered">
		    <a href="/awesome">
              <span class="icon">
                <i class="mdi mdi-24px mdi-sunglasses" style="color: #fc60a8;" aria-hidden="true"></i>
              </span>
              <span class="f3270">Awesome</span>
            </a>
          </p>
          <p class="level-item has-text-centered">
		    <a href="/">
              <span class="icon">
                <i class="mdi mdi-24px mdi-information-outline" aria-hidden="true"></i>
              </span>
              <span class="f3270">О курсе</span>
            </a>
          </p>
        </nav>
      </header>
      <main>
        <section class="section">
          <div class="container">

<h1 class="title">
Transmission Control Protocol
<h1>

<div class="content">
<p>В вводной лекции мы затронули тему простоты использования потоковых сокетов.
Далее мы разберём, что именно это значит и за счёт чего работает.</p>
<p>Скрывают за собой протокол транспортного уровня - TCP.
Такие сокеты создают надёжные двунаправленные потоки между двумя узлами.
Это позволяет почти беззаботно писать в сокет и читать из него.
Что такое “надёжные”?
Нет, это не абсолютно устойчивые ко всему соединения, в том числе полному отключению сети или хотя бы её смене (Wifi &lt;-&gt; Мобильное соединени).
Конкретное значение увидим в Datagram сокетах.</p>
<p><strong>Datagram</strong> сокеты оперируют блоками данных и в целом всё.
Название пришло от скрываемого за ними протокола - User <strong>Datagram</strong> Protocol.
В такие сокеты тоже можно просто писать и читать.
И это даже будет работать.
Но ровно до тех пор, пока ваша сеть идеальна, а данные не вылезают за границы размера пакета.
До этого потоковые сокеты позволяли совсем не думать о пакетах, ведь там ядро реализовывало всю логику TCP само, а нам, программистам выдавало уже готовые данные.
Поток ничем искусственно не ограничен и может быть бесконечно длинным.
С блоком данных - будь добр, уложись в ограничения одного пакета!</p>
<p>Велика беда, разбей большой блок на маленькие и передай?
К сожалению, нет.
Пакеты по пути могут потеряться, продублироваться или даже перемешаться.
Обо всём этом теперь нужно думать программисту.
Но пакеты ещё ведь могут и повредиться?
Это - то немногое, что UDP позволяет проверить.
В пакете может быть хэш данных и заголовка, но в версии IPv4 оно не обязательно.</p>
<p><strong>Raw</strong> (сырые) сокеты не скрывают за собой протокол транспортного уровня.
Это позволяет работать напрямую с IP пакетом.
Данный тип мы рассматривать не будет, так как он используется значительно реже остальных.
Обычно это разработка нового протокола транспортного уровня или специфичное взаимодействие с имеющимися.</p>
<h1 id="tcp">TCP</h1>
<p>Теперь, когда мы уже упомянули потоковые сокеты, давайте рассмотрим протокол, обеспечивающий их работу.</p>
<p>TCP - сессионный протокол.
Это значит, что прежде чем начать отправлять данные, ему необходимо установить сессию, т.е. обменяться рукопожатием с другим узлом:</p>
<p><img src="images/tcp_handshake.png" alt="Изображение TCP рукопожатия" /></p>
<p>Если сессию открыть не удалось, то мы узнаём об отсутствие связи с другим узлом ещё до того, как отправим настоящие данные.</p>
<p>Но вот сессия установлена, что это нам даёт?</p>
<p>Потоки!
Ранее мы обсуждали, что в потоковые сокеты можно просто </p>
<h2 id="obshchenie">Общение</h2>
<h2 id="plavaiushchee-okno-kak-rasshirenie-obshcheniia">Плавающее окно (как расширение общения)</h2>
<h2 id="zavershenie-tcp-sessii">Завершение TCP сессии</h2>
<p><img src="images/tcp_termination.png" alt="" /></p>
<h1 id="utechka-resursov">Утечка ресурсов</h1>
<p>Некоторые браузеры известны тем, что со временем поедают всё больше и больше оперативной памяти.</p>
<p>. . .</p>
<p>Сокеты тоже ресурс</p>
<h2 id="primer-problemy-nezakrytiia-soketa">Пример проблемы незакрытия сокета</h2>
<h1 id="binding-address-port">Binding (address:port)</h1>
<p>::: notes</p>
<p>Могут быть разные ресурсы, ибо биндятся они на разные адреса</p>
<p>:::</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>127.0.0.1:8080
</span><span>127.0.0.2:8080
</span></code></pre>
<h2 id="binding-na-vsekh-adresakh">Binding на всех адресах</h2>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>0.0.0.0:8081
</span></code></pre>
<h2 id="ogranicheniia">Ограничения</h2>
<p>::: notes</p>
<ul>
<li>Зарезервированные требуют прав</li>
<li>Права хорошо бы дропать</li>
<li>Их всё равно можно использовать как угодно</li>
<li>Спросить почему последний именно 65535 (16 бит поля в заголовке)</li>
</ul>
<p>:::</p>
<ul>
<li>0-1023</li>
<li>1024-65535</li>
</ul>

</div>
</div>
        </section>
      </main>

      <footer class="footer" style="margin-top: auto">
        <div class="content has-text-centered">
          <p>
            Сделяль <a href="https://ejiek.com">@ejiek</a>. Исходный код имеет
            лицензию
            <a href="http://opensource.org/licenses/mit-license.php">MIT</a>.
            Содержимое сайта имеет лицензию
            <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a
            >.
          </p>
        </div>
      </footer>
    </div>
  </body>
</html>
